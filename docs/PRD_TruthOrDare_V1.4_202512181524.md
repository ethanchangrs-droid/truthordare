# 真心话 / 大冒险 LLM 生成器 PRD

版本: V1.4_202512181524  
更新时间(UTC+8): 2025-12-18 15:24:00 CST

## 版本记录
| 版本 | 日期 | 更新内容 |
|------|------|---------|
| V1.4 | 2025-12-18 | **技术优化**：统一LLM响应解析逻辑到 shared/llm/parser.js；提升代码质量和可维护性；不影响用户功能 |
| V1.3 | 2025-12-17 | 每次生成1题；新增"大尺度"风格；调整敏感词；缓存逻辑改用随机数；限流20次/分 |
| V1.2 | 2025-12-17 | 改造为 EdgeOne Pages Functions 架构；无需后端服务器 |
| V1.1 | 2025-12-17 | 代码与文档对齐；确认风格枚举11项；确认参数命名规范 |
| V1.0 | 2025-12-17 | 初始版本 |

## 产品愿景
提供一套在聚会、团建、情侣互动等场景下，基于风格与模式（真心话/大冒险）动态生成题目/任务的轻量工具，支持网页与小程序端，保障内容安全与可控。

## 目标用户
- 线下聚会主持人、朋友聚会参与者
- 情侣/伴侣互动用户
- 公司/社团团建主持人

## 目标平台
- Web（SPA 或 SSR）
- 小程序（仅微信）

## 核心流程（MVP）
1. 选择模式：真心话或大冒险
2. 选择风格：如正常、暧昧、搞笑、职场、酒局、大尺度等（共12种）
3. 点击生成：调用边缘函数，返回 **1 条**题目/任务（响应时间 < 1s）
4. 展示结果：直接显示生成的题目
5. 再次点击：生成新的题目（约 1% 概率命中缓存）

## 功能需求（MVP）
- 模式与风格选择组件（12种风格，含大尺度）
- 生成按钮（每次生成1题，生成中禁用防抖）
- 加载态/错误态处理
- 内容安全过滤（大尺度风格放宽限制）
- ~~复制功能~~（暂时禁用）
- ~~再来一题按钮~~（暂时禁用）
- 本地收藏（可选，MVP阶段可暂缓）

## 非功能性需求
- 性能：平均生成延迟 ≤ 3s（取决于供应商与并发）
- 可用性：错误提示清晰，支持重试；空态与占位骨架
- 安全与合规：内容过滤、敏感词规避、避免 NSFW；不记录个人隐私

## 风格枚举（已确认）
- 正常、暧昧、搞笑、职场、酒局、家庭、烧脑、少儿适宜、派对、温情、**大尺度**（共 11 项）
- 「大尺度」风格说明：
  - 仅限18岁以上成人
  - 可包含：暧昧话题、性暗示、轻度身体接触挑战、饮酒惩罚、恶作剧挑战
  - 禁止：违法内容、涉及未成年人、歧视性内容、严重暴力
- 自定义风格（后续版本，需白名单关键词）

## 边界与约束
- 禁止生成违法、暴力、色情、歧视、侵权等内容
- 默认不持久化用户输入与生成结果（除非明确开启“收藏”）

## 指标（MVP）
- 生成成功率、平均响应时长、过滤命中率
- 用户二次生成率、复制点击率

## 已确认项
- 小程序平台：仅微信
- LLM 供应商：DeepSeek（默认），通义千问备选
- 风格与语言：风格按文档枚举（12项）；语言支持中/英，默认 `zh-CN`
- 数据策略：不持久化用户输入与生成结果
- 视觉风格：派对风格（明亮活力）
- **限频策略：每分钟最多 20 次调用**（即 1200 次/小时）
- **生成数量：每次 1 题**
- **缓存策略：随机数种子（1~1000），最多缓存100条，约 0.1% 命中率**
- **部署方案：EdgeOne Pages + Edge Functions（无需后端服务器）** ✅

## 版本范围
- V1（本次）：Web + 小程序 基本生成 + 复制
- V2：收藏/多语言/风格管理后台

## 待澄清项
1. 风格对应的尺度上限细则（例如暧昧的边界、少儿适宜的范围）

## 里程碑与交付
- 文档阶段：完成 PRD/SPEC/UI ✅
- 工程阶段：搭建项目骨架、实现 /api/generate、完成 E2E 验证 ✅
- 架构改造：EdgeOne Pages Functions，无需后端服务器 ✅
- 当前状态：Web 端功能完成，代码已推送 GitHub，待 EdgeOne 部署；小程序端待真机测试
