{
  "project": "真心话/大冒险 LLM 生成器",
  "version": "1.4",
  "created_at": "2025-12-17",
  "total_features": 26,
  "features": [
    {
      "id": "FEAT-001",
      "title": "Web端：选择模式与风格并生成",
      "category": "前端-Web",
      "description": "实现Web端基本功能：模式选择、风格选择、生成、结果展示、复制、再来一题",
      "priority": "P0",
      "steps": [
        "实现模式选择器（真心话/大冒险）",
        "实现风格选择器（11种风格）",
        "实现生成按钮与API调用",
        "实现结果展示列表",
        "实现单条复制功能",
        "实现复制全部功能",
        "实现再来一题按钮"
      ],
      "passes": true
    },
    {
      "id": "FEAT-002",
      "title": "小程序端：选择模式与风格并生成",
      "category": "前端-小程序",
      "description": "实现微信小程序端基本功能，与Web端功能对等",
      "priority": "P0",
      "steps": [
        "实现模式与风格选择UI",
        "配置API地址管理",
        "实现生成与结果展示",
        "实现复制功能",
        "真机测试验证"
      ],
      "passes": false
    },
    {
      "id": "FEAT-003",
      "title": "LLM生成接口与Prompt管理",
      "category": "后端-核心",
      "description": "实现LLM服务封装，支持通义千问/DeepSeek切换，Prompt模板化管理",
      "priority": "P0",
      "steps": [
        "实现LLM服务抽象层",
        "集成通义千问API",
        "集成DeepSeek API",
        "实现Prompt模板管理",
        "实现响应解析"
      ],
      "passes": true
    },
    {
      "id": "FEAT-004",
      "title": "基本内容安全过滤",
      "category": "后端-安全",
      "description": "使用bad-words库+自定义敏感词进行内容过滤",
      "priority": "P0",
      "steps": [
        "集成bad-words库",
        "配置自定义敏感词库",
        "实现过滤函数",
        "集成到生成流程"
      ],
      "passes": true
    },
    {
      "id": "FEAT-005",
      "title": "复制与分享生成内容",
      "category": "前端-交互",
      "description": "Web端：单条复制+复制全部；小程序端：复制按钮",
      "priority": "P0",
      "steps": [
        "实现Web端单条复制",
        "实现Web端复制全部",
        "实现小程序复制功能"
      ],
      "passes": true
    },
    {
      "id": "FEAT-006",
      "title": "实现缓存功能",
      "category": "后端-性能",
      "description": "按mode/style/locale/audienceAge/intensity生成缓存key，TTL 10分钟（内存缓存）",
      "priority": "P1",
      "steps": [
        "选择缓存库（node-cache）",
        "实现缓存key生成逻辑",
        "集成到生成接口",
        "配置TTL为10分钟"
      ],
      "passes": true
    },
    {
      "id": "FEAT-007",
      "title": "前端参数化UI",
      "category": "前端-Web",
      "description": "暴露count/audienceAge/intensity调整UI，当前使用硬编码默认值",
      "priority": "P2",
      "steps": [
        "设计参数调整UI组件",
        "实现count选择器",
        "实现audienceAge选择器",
        "实现intensity选择器",
        "集成到主界面"
      ],
      "passes": false
    },
    {
      "id": "FEAT-008",
      "title": "Web组件拆分",
      "category": "前端-Web",
      "description": "将App.jsx中的组件独立为ModeSelector/StyleSelector/ResultList等",
      "priority": "P2",
      "steps": [
        "拆分ModeSelector组件",
        "拆分StyleSelector组件",
        "拆分ResultList组件",
        "拆分ResultItem组件",
        "优化组件间通信"
      ],
      "passes": false
    },
    {
      "id": "FEAT-009",
      "title": "补生成功能",
      "category": "后端-核心",
      "description": "当过滤后不足count时，允许补生成一次（SPEC中定义）",
      "priority": "P2",
      "steps": [
        "检测过滤后数量",
        "实现补生成逻辑",
        "限制补生成次数为1次",
        "更新元数据记录"
      ],
      "passes": false
    },
    {
      "id": "FEAT-010",
      "title": "配置生产环境API域名",
      "category": "部署",
      "description": "替换miniprogram/config/index.js中的prodConfig.apiBaseUrl",
      "priority": "P1",
      "steps": [
        "确定生产环境域名",
        "更新配置文件",
        "测试生产环境调用"
      ],
      "passes": false
    },
    {
      "id": "FEAT-011",
      "title": "单元测试",
      "category": "测试",
      "description": "后端核心逻辑测试（Prompt组装/过滤函数），目标覆盖率>80%",
      "priority": "P2",
      "steps": [
        "配置测试框架（Jest）",
        "编写Prompt组装测试",
        "编写过滤函数测试",
        "编写LLM服务测试",
        "达到80%覆盖率"
      ],
      "passes": false
    },
    {
      "id": "FEAT-012",
      "title": "结构化日志与监控",
      "category": "后端-运维",
      "description": "使用Winston/Pino，记录generate_request/generate_done/filter_triggered/error事件",
      "priority": "P2",
      "steps": [
        "集成Winston或Pino",
        "配置日志格式",
        "添加关键事件日志",
        "配置日志输出路径"
      ],
      "passes": false
    },
    {
      "id": "FEAT-013",
      "title": "增强内容过滤",
      "category": "后端-安全",
      "description": "接入第三方内容审核API，完善敏感词库",
      "priority": "P2",
      "steps": [
        "选择第三方审核服务",
        "集成API",
        "完善敏感词库",
        "优化过滤策略"
      ],
      "passes": false
    },
    {
      "id": "FEAT-014",
      "title": "本地收藏功能",
      "category": "前端-功能",
      "description": "PRD中标注可选，MVP阶段可暂缓",
      "priority": "P3",
      "steps": [
        "设计收藏数据结构",
        "实现本地存储",
        "实现收藏UI",
        "实现收藏列表查看"
      ],
      "passes": false
    },
    {
      "id": "FEAT-015",
      "title": "多语言支持（en-US）",
      "category": "前端-国际化",
      "description": "当前仅支持zh-CN，V2功能",
      "priority": "P3",
      "steps": [
        "配置i18n框架",
        "翻译UI文案",
        "实现语言切换",
        "测试英文环境"
      ],
      "passes": false
    },
    {
      "id": "FEAT-016",
      "title": "风格管理后台",
      "category": "后端-管理",
      "description": "动态管理风格枚举，V2功能",
      "priority": "P3",
      "steps": [
        "设计管理后台UI",
        "实现风格CRUD接口",
        "实现权限控制",
        "同步到前端"
      ],
      "passes": false
    },
    {
      "id": "FEAT-017",
      "title": "迁移 LLM Base URLs 到环境变量",
      "category": "后端-配置",
      "description": "将通义千问和 DeepSeek 的 API Base URLs 从硬编码迁移到环境变量",
      "priority": "P1",
      "steps": [
        "修改 llmService.js，支持 TONGYI_BASE_URL 环境变量",
        "修改 llmService.js，支持 DEEPSEEK_BASE_URL 环境变量",
        "更新 .env.example 文档",
        "测试不同 Base URL 配置"
      ],
      "passes": false
    },
    {
      "id": "FEAT-018",
      "title": "迁移 LLM 模型名称到环境变量",
      "category": "后端-配置",
      "description": "将 LLM 模型名称（qwen-plus, deepseek-chat）从硬编码迁移到环境变量",
      "priority": "P1",
      "steps": [
        "修改 llmService.js，支持 TONGYI_MODEL 环境变量",
        "修改 llmService.js，支持 DEEPSEEK_MODEL 环境变量",
        "更新 .env.example 文档",
        "测试不同模型配置"
      ],
      "passes": false
    },
    {
      "id": "FEAT-019",
      "title": "迁移 LLM 参数到环境变量",
      "category": "后端-配置",
      "description": "将 temperature 和 max_tokens 从硬编码迁移到环境变量，便于调优",
      "priority": "P2",
      "steps": [
        "修改 llmService.js，支持 LLM_TEMPERATURE 环境变量",
        "修改 llmService.js，支持 LLM_MAX_TOKENS 环境变量",
        "添加类型转换（parseFloat, parseInt）",
        "更新 .env.example 文档",
        "测试参数调优"
      ],
      "passes": false
    },
    {
      "id": "FEAT-020",
      "title": "迁移缓存配置到环境变量",
      "category": "后端-配置",
      "description": "将缓存 TTL 从硬编码迁移到环境变量，便于运维调整",
      "priority": "P2",
      "steps": [
        "修改 cacheService.js，支持 CACHE_TTL 环境变量",
        "添加类型转换（parseInt）",
        "更新 .env.example 文档",
        "测试不同 TTL 配置"
      ],
      "passes": false
    },
    {
      "id": "FEAT-021",
      "title": "Web 端环境变量配置",
      "category": "前端-Web",
      "description": "使用 Vite 环境变量管理端口和代理配置",
      "priority": "P2",
      "steps": [
        "创建 web/.env.development 文件",
        "创建 web/.env.production 文件",
        "修改 vite.config.js，使用环境变量",
        "更新 web/README.md 文档",
        "测试不同环境配置"
      ],
      "passes": false
    },
    {
      "id": "FEAT-022",
      "title": "EdgeOne Pages Functions 改造",
      "category": "部署",
      "description": "将后端逻辑迁移到 EdgeOne 边缘函数，实现无服务器部署",
      "priority": "P1",
      "steps": [
        "创建 functions/api/generate.js 边缘函数",
        "迁移 LLM 调用逻辑到边缘函数",
        "迁移内容过滤逻辑到边缘函数",
        "创建 pages.json 配置文件",
        "更新部署文档 DEPLOY_EDGEONE.md",
        "更新项目 README.md"
      ],
      "passes": true
    },
    {
      "id": "FEAT-023",
      "title": "需求变更：单题生成 + 大尺度风格 + 缓存优化",
      "category": "前端-Web",
      "description": "每次生成1题；新增大尺度风格；缓存使用随机数种子；限流20次/分；禁用复制和再来一题按钮",
      "priority": "P0",
      "steps": [
        "前端 count 改为 1",
        "注释复制按钮和再来一题按钮",
        "新增大尺度风格（红色高亮+18+警告）",
        "前端生成随机数 seed 参数",
        "边缘函数缓存逻辑改用 mode:style:seed",
        "调整敏感词库（放宽暧昧/酒精/恶作剧，保留违法/未成年/歧视）",
        "大尺度风格特殊 Prompt",
        "更新 docs 文档到 V1.3"
      ],
      "passes": true
    },
    {
      "id": "FEAT-024",
      "title": "架构重构：提取公共模块（shared/）",
      "category": "架构-重构",
      "description": "提取 prompt 构建和 LLM 参数配置到 shared/ 公共模块，消除 backend 和 functions 代码重复",
      "priority": "P0",
      "steps": [
        "创建 shared/prompt/dimensions.js - 风格维度定义",
        "创建 shared/prompt/builder.js - Prompt 构建逻辑",
        "创建 shared/config/llm-params.js - LLM 参数配置（单一真实源）",
        "backend 引用 shared/ (直接 import)",
        "创建 functions/api/generate-source.js 引用 shared/",
        "配置 esbuild 打包脚本",
        "实现打包命令 npm run build:functions",
        "清理 backend/.env.example 冗余配置"
      ],
      "passes": true
    },
    {
      "id": "FEAT-025",
      "title": "题目多样性优化",
      "category": "后端-核心",
      "description": "为每种风格定义8个话题维度，优化LLM参数，提升题目多样性和随机性",
      "priority": "P0",
      "steps": [
        "定义12种风格各8个话题维度",
        "优化随机数范围 1~1000",
        "实现 LRU 缓存（上限100条）",
        "seed 参数传递给 LLM",
        "提高 temperature 到 1.0",
        "添加 frequency_penalty=1.5 和 presence_penalty=1.2",
        "端到端测试验证多样性"
      ],
      "passes": true
    },
    {
      "id": "FEAT-026",
      "title": "统一LLM响应解析逻辑",
      "category": "架构-重构",
      "description": "将LLM响应解析逻辑从后端和边缘函数提取到 shared/llm/parser.js，消除82行重复代码，降低维护成本",
      "priority": "P1",
      "steps": [
        "创建 shared/llm/parser.js（从现有代码提取）",
        "修改 backend/src/services/llmService.js（添加导入，删除parseResponse方法）",
        "修改 functions/api/generate-source.js（添加导入，删除parseResponse函数）",
        "运行 npm run build:functions 打包边缘函数",
        "本地测试后端服务（至少3个场景）",
        "部署并测试线上环境（至少3个场景）",
        "循环测试50次验证稳定性"
      ],
      "passes": true
    }
  ],
  "summary": {
    "前端-Web": 5,
    "前端-小程序": 1,
    "前端-交互": 1,
    "前端-功能": 1,
    "前端-国际化": 1,
    "后端-核心": 3,
    "后端-安全": 2,
    "后端-性能": 1,
    "后端-运维": 1,
    "后端-管理": 1,
    "后端-配置": 4,
    "架构-重构": 2,
    "部署": 2,
    "测试": 1,
    "total": 26
  }
}
